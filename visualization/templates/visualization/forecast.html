{% extends "base.html" %}
{% block title %}Pr√©visions M√©t√©o - IA{% endblock %}

{% block extra_head %}
<style>
/* üåü Enhanced Forecast Cards */
.forecast-card {
    border: none;
    border-radius: 16px;
    padding: 1.8rem;
    position: relative;
    transition: transform 0.3s, box-shadow 0.3s;
    background: linear-gradient(145deg, #ffffff, #f1f3f6);
    box-shadow: 6px 6px 15px #d1d9e6, -6px -6px 15px #ffffff;
}
.forecast-card:hover {
    transform: translateY(-5px);
    box-shadow: 10px 10px 20px #c8d1e0, -10px -10px 20px #ffffff;
}
.forecast-title {
    font-weight: 600;
    font-size: 1.1rem;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
}
.forecast-value {
    font-size: 1.7rem;
    font-weight: 700;
    margin-top: 0.5rem;
}
.forecast-trend {
    font-size: 0.85rem;
    color: #6c757d;
    margin-top: 0.3rem;
}
.badge-alert {
    position: absolute;
    top: 15px;
    right: 15px;
    font-size: 0.8rem;
    font-weight: 600;
    padding: 0.35em 0.6em;
    border-radius: 10px;
    color: #fff;
}
.badge-safe { background-color: #4ade80; }
.badge-warning { background-color: #facc15; }
.badge-danger { background-color: #f87171; }

/* Section header style */
.forecast-header {
    padding: 1rem 1.5rem;
    border-radius: 12px;
    margin-bottom: 1.5rem;
}
</style>
{% endblock %}

{% block content %}
<div class="forecast-header text-center">
    <h2 class="fw-bold mb-1">ü§ñ Pr√©visions M√©t√©o - IA</h2>
    <p class="mb-0">Prochaines 5 heures / tendances des param√®tres cl√©s</p>
</div>

<div class="row g-4 justify-content-center text-center">

    <!-- Temperature Forecast -->
    <div class="col-12 col-md-4 col-lg-3">
        <div class="forecast-card">
            <div class="forecast-title text-danger">üå°Ô∏è Temp√©rature</div>
            <span class="badge-alert badge-danger">
                {{ forecast.temperature_alert|default:"‚ö†Ô∏è" }}
            </span>
            <div class="forecast-value">{{ forecast.temperature.0|floatformat:1 }} ¬∞C</div>
            <canvas id="tempForecastChart" height="60"></canvas>
            <div class="forecast-trend">
                {{ forecast.temperature|first }} ‚Üí {{ forecast.temperature|last }} ¬∞C
                {% if forecast.temperature.0 < forecast.temperature.1 %}
                    <i class="fa-solid fa-arrow-up text-danger"></i>
                {% else %}
                    <i class="fa-solid fa-arrow-down text-success"></i>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Rainfall Forecast -->
    <div class="col-12 col-md-4 col-lg-3">
        <div class="forecast-card">
            <div class="forecast-title text-secondary">üåßÔ∏è Pluie</div>
            <span class="badge-alert badge-warning">
                {{ forecast.rainfall_alert|default:"‚ö†Ô∏è" }}
            </span>
            <div class="forecast-value">{{ forecast.rainfall.0|floatformat:1 }} mm</div>
            <canvas id="rainForecastChart" height="60"></canvas>
            <div class="forecast-trend">
                {{ forecast.rainfall|first }} ‚Üí {{ forecast.rainfall|last }} mm
                {% if forecast.rainfall.0 < forecast.rainfall.1 %}
                    <i class="fa-solid fa-arrow-up text-primary"></i>
                {% else %}
                    <i class="fa-solid fa-arrow-down text-success"></i>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- UV Index Forecast -->
    <div class="col-12 col-md-4 col-lg-3">
        <div class="forecast-card">
            <div class="forecast-title text-warning">‚òÄÔ∏è UV Index</div>
            <span class="badge-alert badge-danger">
                {{ forecast.uv_alert|default:"‚ö†Ô∏è" }}
            </span>
            <div class="forecast-value">{{ forecast.uv_index.0|floatformat:1 }} UV</div>
            <canvas id="uvForecastChart" height="60"></canvas>
            <div class="forecast-trend">
                {{ forecast.uv_index|first }} ‚Üí {{ forecast.uv_index|last }} UV
                {% if forecast.uv_index.0 < forecast.uv_index.1 %}
                    <i class="fa-solid fa-arrow-up text-danger"></i>
                {% else %}
                    <i class="fa-solid fa-arrow-down text-success"></i>
                {% endif %}
            </div>
        </div>
    </div>

</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function createMiniChart(ctx, data, color) {
    return new Chart(ctx, {
        type: 'line',
        data: {
            labels: Array.from({length: data.length}, (_, i) => i+1),
            datasets: [{
                data: data,
                borderColor: color,
                backgroundColor: color.replace('1)', '0.1)'),
                tension: 0.4,
                fill: true,
                pointRadius: 0
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { x: { display: false }, y: { display: false } },
        }
    });
}

// Render mini charts
createMiniChart(document.getElementById('tempForecastChart'), {{ forecast.temperature|safe }}, 'rgba(239,68,68,1)');
createMiniChart(document.getElementById('rainForecastChart'), {{ forecast.rainfall|safe }}, 'rgba(107,114,128,1)');
createMiniChart(document.getElementById('uvForecastChart'), {{ forecast.uv_index|safe }}, 'rgba(245,158,11,1)');
</script>
{% endblock %}
